<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Gmvault: gmail backup</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="backup and restore your gmail account">
    <meta name="author" content="guillaume aubert">

    <!-- Le styles -->
    <link href="./assets/css/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/font-awesome.css">
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="assets/css/docs.css" rel="stylesheet">
    <link href="assets/js/google-code-prettify/prettify.css" rel="stylesheet">
    <style>
      body {
        /*padding-top: 60px;*/ /* was adding Gmvault and pushing it 60px to make the container go all the way to the bottom of the topbar */
      }
      /* to properly fix the positionning of internal reference when name id used*/
      a[name]{position:relative;top:-40px; visibility:collapsed;}
    </style>
    <link href="./assets/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="./assets/ico/gmv-favicon.ico">
    <!--<link rel="apple-touch-icon-precomposed" sizes="114x114" href="./assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="./assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="./assets/ico/apple-touch-icon-57-precomposed.png">-->
  </head>

  <body data-spy="scroll" data-target=".subnav" data-offset="50">

<!-- Navbar
    ================================================== -->
<div class="navbar navbar-fixed-top">
 <div class="navbar-inner">
  <div class="container"> <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </a> <a class="brand" href="./index.html">Gmvault</a>
   <div class="nav-collapse">
    <ul class="nav">
     <li class=""> <a href="./index.html"><i class="icon-home icon-small"></i>Overview</a> </li>
     <li class="dropdown" id="install-menu">
       <a class="dropdown-toggle" data-toggle="dropdown" href="#install-menu">
         Install
         <b class="caret"></b>
       </a>
       <ul class="dropdown-menu">
         <li class=""><a href="./install.html#install">Install</a></li>
         <li class=""> <a href="./install.html#win_install">Windows Installation</a> </li>
         <li class=""> <a href="./install.html#mac_install">Mac OSX Installation</a> </li>
         <li class=""> <a href="./install.html#lin_install">Linux Installation</a> </li>
         <li class=""> <a href="./install.html#py_install">Python Installation</a> </li>
         <li class="divider"></li>
         <li class=""> <a href="./gmail_setup.html">Gmail Setup</a> </li>
         <li class=""> <a href="./gmail_setup.html#quickstart">Quick Start</a> </li>
         <li class=""> <a href="./in_depth.html">In Depth</a> </li>
       </ul>
     </li>
     <li class=""> <a href="./gmail_setup.html"><i class="icon-time icon-small"></i>Gmail Setup</a> </li>
     <li class=""> <a href="./gmail_setup.html#quickstart"><i class="icon-time icon-small"></i>Quick Start</a> </li>
     <li class="active dropdown" id="in_depth-menu">
       <a class="dropdown-toggle" data-toggle="dropdown" href="#in_depth-menu">
         <i class="icon-cogs icon-small"></i>In Depth
         <b class="caret"></b>
       </a>
       <ul class="dropdown-menu">
         <li class=""><a href="./in_depth.html#indepth">In Depth</a></li>
         <li class=""> <a href="./in_depth.html#authentication">Authentication</a> </li>
         <li class=""> <a href="./in_depth.html#backup">Backup your account</a> </li>
         <li class=""> <a href="./in_depth.html#restore">Restore your account</a> </li>
         <li class=""> <a href="#py_install">Python Installation</a> </li>
         <li class="divider"></li>
         <li class=""> <a href="./gmail_setup.html">Gmail Setup</a> </li>
         <li class=""> <a href="./gmail_setup.html#quickstart">Quick Start</a> </li>
         <li class=""> <a href="./in_depth.html">In Depth</a> </li>
       </ul>
     </li>
     <li class=""> <a href="./report_pb.html"><i class="icon-exclamation-sign icon-small"></i>Problems</a> </li>
     <li class="divider-vertical"></li>
     <li class=""> <a href="./support.html"><i class="icon-heart icon-small"></i>Support</a> </li>
     <li class=""> <a href="./download.html"><i class="icon-download icon-small"></i>Download</a> </li>
    <ul class="nav">
      <li><a href="mailto:guillaume.aubert@gmail.com"><i class="icon-envelope"></i> Me</a></li>
    </ul>
    </ul>
   </div>
  </div>
 </div>
</div> <!-- End Navbar -->

    <div class="container-fluid">
       <a id="indepth" name="indepth"></a><h1>In Depth</h1>
        <p></br>Gmvault is a user friendly command-line tool that setup most of the necessary defaults to quickly sync (backup) your gmail account or restore it to a gmail account.
        </br>It should be self-explanatory. Use gmvault -h to see the different options and how the tool works.</br>
        <pre>$./gmvault -h

usage: gmvault [-h] [-v] {restore,sync} ...

optional arguments:
  -h, --help      show this help message and exit
  -v, --version   show program's version number and exit

subcommands:
  {restore,sync}  valid subcommands.
    sync          synchronize with a given gmail account.
    restore       restore gmvault-db to a given email account.

Examples:

a) Get help for each of the individual commands

#> gmvault sync -h
#> gmvault restore --help


</pre>
        </br>Gmvault is a command-oriented tool and every Gmvault call needs to contain a subcommand (sync or restore).
        </br>You will first need to setup the credential (token or password) for the different gmail accounts you want to use prior to syncing or restoring them with Gmvault.
        </br>This will allow Gmvault to automatically connect to the accounts you want to work with.
        </p>
        <h2><a id="authentication" name="authentication"></a>Authentication</h2>
        <p></br>
           To authenticate yourself and authorize Gmvault accessing your Gmail account, Gmvault allows users to use a Gmail XOAuth token or your Gmail login password.</br>
           The <strong>XOAuth</strong> authentication is the recommended way to access your account. This method is activated by default. </br>
           After the first authentication for a given account, the XOAuth token is stored in $HOME/.gmvault or %HOME% (c:\users\MYUSER) and will be used for consequent authentications.</br>
           The following example uses an XOAuth token for accessing a gmail account. If the token has not been created for the used Gmail account, Gmvault will automatically try to create one with your help.</br>
           Just follow the instructions given by Gmvault.
        </p>
    <p><pre>!$ ./gmvault sync myuser@gmail.com

Use gmvault-db /home/myuser/gmvault-db.
Oauth will be used for authentication.

gmvault will now open a web browser page in order for you to grant gmvault access to your Gmail.
Please make sure you're logged into the correct Gmail account (myuser@gmail.com) before granting access.
Press ENTER to open the browser. Once you've granted access you can switch back to gmvault.
</pre></p>
    <p>Press ENTER and Gmvault will launch a browser to allow you granting access on the gmail account you want to use.</br>
       <strong>Be sure to verify that you are logged on the right account.</strong>
   </p>
   <!-- add grant access page and second page -->
   <div class="thumbnail">
		<h5>Grant access to Gmvault.</h5>
		<img src="./assets/img/xoauth-auth-grant-access.png" alt="">
   </div>
   
   <div class="thumbnail">
		<h5>You should see this once you have granted access to Gmvault.</h5>
		<img src="./assets/img/xoauth-auth-access-granted.png" alt="">
   </div>
   <p>Once you have granted access to Gmvault, press one more time ENTER to let Gmvault finish its work.</p>
   <p><pre>You should now see the web page on your browser now.
If you don't, you can manually open:

https://www.google.com/accounts/OAuthAuthorizeToken?oauth_token=4%abdedsk-leskdkrs-QM4ZnL6tLDy

Once you've granted gmvault access, press the Enter key.</pre></br>
Below is a screenshot of a complete authentication session on Windows.</p>
 <div class="thumbnail">
		<h5>Grant access to Gmvault.</h5>
		<img src="./assets/img/full-access-granted-screenshot.png" alt="">
   </div>
<p>After that authentication session Gmvault will automatically use the XOAuth token stored under $HOME/.gmvault or %HOME% (c:\users\MYUSER) for all session with the MYUSER user.
</br>You can renew a saved oauth token with the option <strong>--renew-oauth-tok</strong>. You will again go through the Gmail OAuth authentication procedure.</p>

    
    <h4>Authentication with gmail password</h4>
		<p></br>If you do not want to use the Gmail XOAuth token (not recommended), you can always use Gmvault with your password.
		</br>In that case, you will have to interactively enter your password at the beginning of the Gmvault session.
		</p>
		<p><pre>$./gmvault sync myuser@gmail.com -p 

Use gmvault-db /home/myuser/gmvault-db.
Gmail password will be used for authentication.

Please enter gmail password for myuser@gmail.com and press ENTER:
Connect to Gmail server.
53432 emails to be fetched.
Process email num 0 (imap_id:1) from 2005-10.
Process email num 1 (imap_id:2) from 2005-10.
Process email num 2 (imap_id:3) from 2005-10.
Process email num 3 (imap_id:5) from 2005-10.
...</pre></p>
      <p>You can also if necessary store your password in  $HOME/.gmvault or %HOME% (c:\users\MYUSER) with <strong>--store-passwd</strong> command.
      </br>The password will be encrypted before to be stored. Note that functionnality is provided for flexibility purposes but is not recommended.
      </br>Prefer the XOAuth authentication if you need to automate Gmvault synchronisation and restoration operations.
      </p>
      <p><pre>$./gmvault sync myuser@gmail.com -p --store-passwd

Use gmvault-db /home/myuser/gmvault-db.
Gmail password will be used for authentication.

Please enter gmail password for myuser@gmail.com and press ENTER:
Store password for myuser@gmail.com in $HOME/.gmvault.
Connect to Gmail server.
53432 emails to be fetched.
Process email num 0 (imap_id:1) from 2005-10.
Process email num 1 (imap_id:2) from 2005-10.
Process email num 2 (imap_id:3) from 2005-10.
Process email num 3 (imap_id:5) from 2005-10.
...</pre>
   <p>Finally, it is also possible to renew your stored password with <strong>--renew-passwd</strong>.</p>
   <p><pre>$./gmvault sync myuser@gmail.com -p --renew-passwd

Use gmvault-db /home/myuser/gmvault-db.
Gmail password will be used for authentication.

Please enter gmail password for myuser@gmail.com and press ENTER:
Store password for myuser@gmail.com in $HOME/.gmvault.
Connect to Gmail server.
53432 emails to be fetched.
Process email num 0 (imap_id:1) from 2005-10.
Process email num 1 (imap_id:2) from 2005-10.
Process email num 2 (imap_id:3) from 2005-10.
Process email num 3 (imap_id:5) from 2005-10.
...</pre></p>
<h2><a id="backup" name="backup"></a>Making a backup of your Gmail account</h2>
</br>
<p>The sync command of Gmvault allow users to backup the Gmail account of their choice.
</br>use <strong>gmvault sync -h</strong> to get explanations regarding all options. Examples are also provided after the options details.
</br><pre>$./gmvault sync -h

usage: gmvault sync [-h] [-t TYPE] [-d DB_DIR] [-o] [--renew-passwd]
                    [--store-passwd] [-p] [-r REQ] [-g REQ] [-e]
                    [-z DB_CLEANING] [-m] [--server HOSTNAME] [--port PORT]
                    [--debug]
                    email

positional arguments:
  email                 email to sync with.

optional arguments:
  -h, --help            show this help message and exit
  -t TYPE, --type TYPE  type of synchronisation: full|quick|custom. (default:
                        full)
  -d DB_DIR, --db-dir DB_DIR
                        Database root directory. (default: ./gmvault-db)

... help shortened ...

  --server HOSTNAME     Gmail imap server hostname. (default: imap.gmail.com)
  --port PORT           Gmail imap server port. (default: 993)
  --debug               Activate debugging info

Examples:

a) Full synchronisation with email and oauth login in ./gmvault-db

#> gmvault sync foo.bar@gmail.com

b) Quick daily synchronisation (only the last 2 months are scanned)

#> gmvault sync --type quick foo.bar@gmail.com

c) Custom synchronisation with an IMAP request for advance users

#> gmvault sync --type custom --imap-req 'Since 1-Nov-2011 Before 10-Nov-2011' 'foo.bar@gmail.com'

d) Custom synchronisation with an Gmail request for advance users

#> gmvault sync --type custom --gmail-req 'in:inbox from:foo' 'foo.bar@gmail.com'

e) Full synchronisation for German users that have to use googlemail instead of gmail

#> gmvault sync --imap-server imap.googlemail.com 'foo.bar@gmail.com'
</pre>

</br>gmvault sync myuser@gmail.com will backup the entire content of your gmail account from the oldest to newest email.
</br>You will also notice that Gmvault tries to estimate how long it will take to backup your entire gmail account every 50 emails.
</br><pre>$./gmvault sync guillaume.aubert@gmail.com -p

Use gmvault-db /home/aubert/gmvault-db.
Gmail password will be used for authentication.

Please enter gmail password for guillaume.aubert@gmail.com and press ENTER:
Connect to Gmail server.
35965 emails to be fetched.
Process email num 0 (imap_id:1) from 2004-10.
Process email num 1 (imap_id:2) from 2004-10.
Process email num 2 (imap_id:3) from 2004-10.
...
Process email num 48 (imap_id:55) from 2004-10.
Process email num 49 (imap_id:56) from 2004-10.

== Processed 50 emails in 6s. 35915 left to be stored (time estimate 1h 11m 50s).==

Process email num 50 (imap_id:58) from 2004-10.
Process email num 51 (imap_id:59) from 2004-10.
Process email num 52 (imap_id:60) from 2004-10.
...
</pre>
Gmvault will list all the emails that are backed up on disk.
</br>Your emails will be stored in an email database created by default in $HOME/.gmvault-db.
</br>Use the <strong>-d</strong> or <strong>--db-dir</strong> to choose where the email database is going to be created.
</br>When you create an email database, it is automatically bonded to the email account you would like to backup.
</br>If you try to backup a Gmail account with an email database bounded with another email, Gmvault will exit in error.
<pre>$./gmvault sync gsync.mtester@gmail.com

Use gmvault-db /home/aubert/gmvault-db.
Oauth will be used for authentication.

Use oauth credentials from /home/aubert/.gmvault/gsync.mtester@gmail.com.oauth.
Successfully read oauth credentials.

Connect to Gmail server.
Error The email database /home/aubert/gmvault-db is already associated with guillaume.aubert@gmail.com. Use option (-m, --multiple-db-owner) if you want to link it with gsync.mtester@gmail.com. For more information see log file

usage: gmvault [-h] [-v] {restore,sync} ...

optional arguments:
  -h, --help      show this help message and exit
  -v, --version   show program's version number and exit

subcommands:
  {restore,sync}  valid subcommands.
    sync          synchronize with a given gmail account.
    restore       restore gmvault-db to a given email account.

Examples:

a) Get help for each of the individual commands

#> gmvault sync -h
#> gmvault restore --help

$
</pre>
If you wish to backup multiple Gmail accounts in one email database, you can use the <strong>-m</strong> or <strong>--multiple-db-owner</strong> to let Gmvault allowing it.
</br>Gmvault provides 3 types of synchronisations with <strong>-t, --type</strong> full, quick or custom.
The full synchronisation scans your complete email box and store locally on disk if the email doesn't exist already. Gmvault uses the full synchronisation type by default. 
</br>The quick type is used to daily backup your email account automatically (with a cron job for example) and it updates the local email repository with the latest additions.
</br>The quick synchronisation goes up to two month backward in time and update your local on disk email repository to reflect the addition and deletion of emails as well the labels modifications.
</br>The custom synchronisation allows to provide a custom imap or gmail request if you only wish to backup a subset of your emails.
</p>
<h2><a id="restore" name="restore"></a>Restoring your Gmail account</h2>
</br>
<p>You can use the restore command to recreate your gmail account in case of problems. Like the sync command the restore command provides 2 types of restore with <strong>-t, --type</strong> full or quick.
The full restore will try to restore completly the local email repository into the given email account while the quick restore will only restore the last 2 months of emails. Restore only upload new emails onto your given gmail account and also update the associated information such as labels but never delete an email from inbox. 
</br><pre>a) Complete restore of your gmail account (backed up in ~/gmvault-db) into anewfoo.bar@gmail.com

$> ./gmvault restore -d ~/gmvault-db anewfoo.bar@gmail.com

b) Quick restore (restore only the last 2 months to make regular updates) of your gmail account into anewfoo.bar@gmail.com

$> ./gmvault restore --type quick -d ~/gmvault-db foo.bar@gmail.com
</pre>
</br>If it also possible to apply a given label to the current update you are performing:
<pre>$>./gmvault restore --label "20120422-gmvault-restore" -d ~/gmvault-db anewfoo.bar@gmail.com</pre>
This will apply "20120422-gmvault-restore" to all restored emails.
</p>

	</div> <!-- page-header -->
 </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="./assets/js/jquery.js"></script>
    <script src="./assets/js/bootstrap-transition.js"></script>
    <script src="./assets/js/bootstrap-alert.js"></script>
    <script src="./assets/js/bootstrap-modal.js"></script>
    <script src="./assets/js/bootstrap-dropdown.js"></script>
    <script src="./assets/js/bootstrap-scrollspy.js"></script>
    <script src="./assets/js/bootstrap-tab.js"></script>
    <script src="./assets/js/bootstrap-tooltip.js"></script>
    <script src="./assets/js/bootstrap-popover.js"></script>
    <script src="./assets/js/bootstrap-button.js"></script>
    <script src="./assets/js/bootstrap-collapse.js"></script>
    <script src="./assets/js/bootstrap-carousel.js"></script>
    <script src="./assets/js/bootstrap-typeahead.js"></script>

    <!-- analytics with stathat -->
    <img src="http://api.stathat.com/c?ukey=NjM3IHOkfz0i1DliotgKSxKEqGc~&key=uEWjLRysHJgQFmszTFzGKCBLRkFk&count=1" style="display:none;" width="1" height="1"/>

	<!-- google analytics for gaubert.github.com/gmvault -->
    <script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-31019122-1']);
	  _gaq.push(['_setDomainName', 'github.com']);
	  _gaq.push(['_setAllowLinker', true]);
	  _gaq.push(['_trackPageview']);

	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

    </script>
	<!-- google analytics for gmvault.org -->
	<script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-31356001-1']);
	  _gaq.push(['_setDomainName', 'gmvault.org']);
	  _gaq.push(['_trackPageview']);

	  (function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

    </script>

  </body>
</html>

